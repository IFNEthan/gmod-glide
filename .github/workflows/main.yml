name: FTP Deployment

on:
  push:
    branches:
      - main

jobs:
  deploy_sftp:
    if: "!contains(github.event.head_commit.message, '[skip]')"
    runs-on: ubuntu-latest

    steps:
      - name: ðŸšš Get latest code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          clean: false

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '14'

      - name: Install dependencies
        run: npm install ssh2-sftp-client

      - name: ðŸ“‚ Deploy Files
        env:
          SFTP_HOST: ${{ secrets.SFTP_HOST }}
          SFTP_PORT: ${{ secrets.SFTP_PORT }}
          SFTP_USERNAME: ${{ secrets.SFTP_USERNAME }}
          SFTP_PASSWORD: ${{ secrets.SFTP_PASSWORD }}
          SOURCE_DIR: '.'
          DESTINATION_DIR: './garrysmod/addons/glide_fork'
        run: node .github/scripts/deploy.js